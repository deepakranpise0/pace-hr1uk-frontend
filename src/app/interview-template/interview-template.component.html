<main style="padding-top: 5px;">
    <h1 class="mat-h1">User Interview Template</h1>
    <mat-divider></mat-divider>
    <mat-card>
        <mat-card-content>
            <div class="form-content">
                <mat-stepper [orientation]="smallScreen ? 'vertical' : 'horizontal'" [linear]="false" #stepper>
                    <mat-step [stepControl]="configFormGroup">
                        <form [formGroup]="configFormGroup" (ngSubmit)="onNextClick()">
                            <ng-template matStepLabel>Configure Template</ng-template>
                            <mat-form-field>
                                <mat-label>Select User</mat-label>
                                <mat-select formControlName="userId">
                                    @for (user of users; track user) {
                                    <mat-option [value]="user._id">{{user.name}}</mat-option>
                                    }
                                </mat-select>
                            </mat-form-field>
                            <div class="mat-form-field-row">
                                <div class="mat-form-field-col">
                                    <mat-form-field>
                                        <mat-label>Domain</mat-label>
                                        <mat-select formControlName="domainId">
                                            <mat-option *ngFor="let domain of domains"
                                                [value]="domain._id">{{domain.name}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <div class="mat-form-field-col">
                                    <mat-form-field>
                                        <mat-label>Assessment Type</mat-label>
                                        <mat-select formControlName="assessmentId">
                                            <mat-option *ngFor="let assessmentType of assessmentTypes"
                                                [value]="assessmentType._id">{{assessmentType.name}}</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>

                            <div class="align-end">
                                <button mat-raised-button color="primary" type="submit" matStepperNext>Next</button>
                            </div>
                        </form>
                    </mat-step>
                    <mat-step [stepControl]="secondFormGroup" label="Add Questions">
                        <mat-accordion>
                            <mat-expansion-panel (opened)="panelOpenState = true" (closed)="panelOpenState = false"
                                [disabled]="!selectedQuestions.length">
                                <mat-expansion-panel-header>
                                    <mat-panel-title>
                                        Selected Questions ({{selectedQuestions.length}})
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <mat-list *ngFor="let question of selectedQuestions; let i = index"
                                    >
                                    <div [ngClass]="i%2 === 0 ? 'even' : 'even'" class="flex-container highlight-on-hover center-content">
                                        <div class="left-content">{{question.name}}</div>
                                        <div class="right-content">
                                            <div class="icon-container">
                                                <button (click)="removeQuestion(i)">
                                                    <mat-icon class="action-mat-icon delete">delete</mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </mat-list>
                            </mat-expansion-panel>
                        </mat-accordion>


                        <form [formGroup]="secondFormGroup" class="questions-table">
                            <table mat-table [dataSource]="questions">

                                <!-- Position Column -->
                                <ng-container matColumnDef="no">
                                    <th mat-header-cell *matHeaderCellDef> No. </th>
                                    <td mat-cell *matCellDef="let element; let i = index"> {{i+1}} </td>
                                </ng-container>

                                <!-- Name Column -->
                                <ng-container matColumnDef="section">
                                    <th mat-header-cell *matHeaderCellDef> Section </th>
                                    <td mat-cell *matCellDef="let element"> {{element.sectionId.name}} </td>
                                </ng-container>

                                <ng-container matColumnDef="name">
                                    <th mat-header-cell *matHeaderCellDef> Question </th>
                                    <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                                </ng-container>

                                <!-- Weight Column -->
                                <ng-container matColumnDef="description">
                                    <th mat-header-cell *matHeaderCellDef> Description </th>
                                    <td mat-cell *matCellDef="let element"> {{element.description}} </td>
                                </ng-container>

                                <ng-container matColumnDef="action">
                                    <th mat-header-cell *matHeaderCellDef style="padding-left: 30px;"> Action </th>
                                    <td mat-cell *matCellDef="let element">
                                        <div class="icon-container">
                                            <mat-checkbox color="primary" [checked]="element.isSelected"
                                                (change)="selectQuestion($event,element)">

                                            </mat-checkbox>
                                            <!-- <button (click)="editData(element)">
                                                <mat-icon class="action-mat-icon edit">edit</mat-icon>
                                            </button>
                                            <button (click)="deleteData(element._id)">
                                                <mat-icon class="action-mat-icon delete">delete</mat-icon>
                                            </button> -->
                                        </div>
                                    </td>
                                </ng-container>

                                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                            </table>

                            <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons
                                aria-label="Select page of periodic elements">
                            </mat-paginator>
                            <div>
                                <button mat-button matStepperPrevious>Back</button>
                                <button mat-button matStepperNext>Next</button>
                            </div>
                        </form>
                    </mat-step>
                    <mat-step>
                        <ng-template matStepLabel>Done</ng-template>
                        <p>You are now done.</p>
                        <div class="align-end">
                            <button mat-button matStepperPrevious>Back</button>
                            <button mat-button (click)="stepper.reset()">Reset</button>
                        </div>
                    </mat-step>
                </mat-stepper>

            </div>
        </mat-card-content>
    </mat-card>
</main>