<main>
  <div style="display: flex; align-items: center;">
    <div style="padding: 10px; display: flex; align-items: center;" (click)="setTabVisible('templateTab')">
      <mat-icon
        class="pointer"
        aria-hidden="false"
        aria-label="Example home icon"
        fontIcon="keyboard_backspace"
      ></mat-icon>
    </div>
    <h5 class="mat-h2" style="margin: 0; flex-grow: 1;">Interview Templates</h5>
    <div style="padding: 0.5rem;">
      <button
        class="align-end"
        mat-stroked-button
        color="accent"
        type="button"
        (click)="setTabVisible('createTab')"
      >
        Create Template
      </button>
    </div>
  </div>

  <mat-divider></mat-divider>
  <mat-tab-group *ngIf="templateTab" style="background: #d5e2f2">
    <mat-tab label="Template List">
      <div class="table-container">
        <div class="mat-elevation-z8">
          <table mat-table [dataSource]="templateData">
            <ng-container matColumnDef="no">
              <th mat-header-cell *matHeaderCellDef>No.</th>
              <td mat-cell *matCellDef="let element; let i = index">
                {{ i + 1 }}
              </td>
            </ng-container>

            <ng-container matColumnDef="templateName">
              <th mat-header-cell *matHeaderCellDef>Template Name</th>
              <td mat-cell *matCellDef="let element">
                {{ element.templateName }}
              </td>
            </ng-container>

            <ng-container matColumnDef="domain">
              <th mat-header-cell *matHeaderCellDef>Domain</th>
              <td mat-cell *matCellDef="let element">
                {{ element.domainId.name }}
              </td>
            </ng-container>

            <ng-container matColumnDef="action">
              <th mat-header-cell *matHeaderCellDef style="padding-left: 30px">
                Action
              </th>
              <td mat-cell *matCellDef="let element">
                <div class="icon-container">
                  <button (click)="viewData(element)">
                    <mat-icon class="action-mat-icon pointer view">open_in_new</mat-icon>
                  </button>
                  <button (click)="editData(element)">
                    <mat-icon class="action-mat-icon pointer edit"
                      >edit</mat-icon
                    >
                  </button>
                  <button (click)="deleteData(element._id)">
                    <mat-icon class="action-mat-icon pointer delete"
                      >delete</mat-icon
                    >
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumn"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumn"></tr>
          </table>

          <mat-paginator
            [length]="templateData.length"
            [pageSizeOptions]="[10, 20]"
            showFirstLastButtons
            aria-label="Select page of periodic elements"
          >
          </mat-paginator>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
  <mat-tab-group *ngIf="createTab" style="background: #d5e2f2">
    <mat-tab label="New Template Creation">
      <mat-stepper
        [orientation]="smallScreen ? 'vertical' : 'horizontal'"
        [linear]="true"
        #stepper
      >
        <mat-step [stepControl]="configFormGroup">
          <div class="template-create-container">
            <form [formGroup]="configFormGroup">
              <ng-template matStepLabel>Configure Template</ng-template>
              <mat-form-field>
                <mat-label>Template Name</mat-label>
                <input matInput formControlName="templateName" />
                <mat-error
                  *ngIf="
                    configFormGroup.get('templateName')?.invalid &&
                    configFormGroup.get('name')?.touched
                  "
                >
                  Name is required
                </mat-error>
              </mat-form-field>
              <div class="mat-form-field-row">
                <div class="mat-form-field-col">
                  <mat-form-field>
                    <mat-label>Domain</mat-label>
                    <mat-select formControlName="domainId">
                      <mat-option
                        *ngFor="let domain of domains"
                        [value]="domain._id"
                        >{{ domain.name }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
                <div class="mat-form-field-col">
                  <mat-form-field>
                    <mat-label>Assessment Type</mat-label>
                    <mat-select formControlName="assessmentId">
                      <mat-option
                        *ngFor="let assessmentType of assessmentTypes"
                        [value]="assessmentType._id"
                        >{{ assessmentType.name }}</mat-option
                      >
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
            </form>
          </div>
          <div class="align-end example-button-row">
            <button
              mat-raised-button
              color="primary"
              type="button"
              matStepperNext
            >
              Next
            </button>
          </div>
        </mat-step>
        <mat-step [stepControl]="questionsFormGroup" label="Add Questions">
          <div class="template-container">
            <div *ngIf="questionsFormGroup.get('questionSet')?.value">
              <div class="accordion-container">
                <mat-accordion class="accordion">
                  <mat-expansion-panel
                    *ngFor="
                      let item of questionsFormGroup.get('questionSet')
                        ?.value || []
                    "
                  >
                    <mat-expansion-panel-header>
                      <mat-panel-title>
                        {{ item?.sectionName }} ({{
                          item?.questionsArray?.length
                        }})
                      </mat-panel-title>
                    </mat-expansion-panel-header>
                    <mat-list>
                      <mat-list-item
                        *ngFor="
                          let question of item.questionsArray;
                          let i = index
                        "
                        [ngClass]="i % 2 === 0 ? 'even' : 'odd'"
                      >
                        {{ i + 1 }}. {{ question.name }}
                      </mat-list-item>
                    </mat-list>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
            </div>
            <form [formGroup]="questionsFormGroup" class="questions-table">
              <table mat-table [dataSource]="questions">
                <ng-container matColumnDef="no">
                  <th mat-header-cell *matHeaderCellDef>No.</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    {{ i + 1 }}
                  </td>
                </ng-container>
                <ng-container matColumnDef="section">
                  <th mat-header-cell *matHeaderCellDef>Section</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.sectionId.name }}
                  </td>
                </ng-container>
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef>Question</th>
                  <td mat-cell *matCellDef="let element">{{ element.name }}</td>
                </ng-container>
                <ng-container matColumnDef="description">
                  <th mat-header-cell *matHeaderCellDef>Description</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.description }}
                  </td>
                </ng-container>
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef>Action</th>
                  <td mat-cell *matCellDef="let element">
                    <mat-checkbox
                      color="primary"
                      [checked]="element.isSelected"
                      (change)="selectQuestion($event, element)"
                    ></mat-checkbox>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumns"
                ></tr>
              </table>
              <mat-paginator
                [pageSizeOptions]="[10, 20]"
                showFirstLastButtons
                aria-label="Select page of questions"
                (page)="onPageChange($event)"
              ></mat-paginator>
            </form>
          </div>
          <div class="align-end example-button-row">
            <button
              mat-stroked-button
              matStepperPrevious
              color="accent"
              type="button"
            >
              Back
            </button>
            <button
              mat-raised-button
              matStepperNext
              color="primary"
              type="button"
            >
              Next
            </button>
          </div>
        </mat-step>
        <mat-step label="Final Submission">
          <div>
            <h1 class="title-flex">
              Verify details <mat-icon>check_circle_outline</mat-icon>
            </h1>
          </div>
          <div class="template-info">
            <p>
              Template Name : {{ configFormGroup.controls.templateName.value }}
            </p>
            <p>
              Domain :
              {{
                getConfigName(
                  masterDataType.DOMAIN,
                  configFormGroup.controls.domainId.value || ''
                )
              }}
            </p>
            <p>
              Assessment Type:
              {{
                getConfigName(
                  masterDataType.ASSESSMENT_TYPE,
                  configFormGroup.controls.assessmentId.value || ''
                )
              }}
            </p>
          </div>
          <div *ngIf="questionsFormGroup.get('questionSet')?.value">
            <div
              class="accordion-container"
              *ngFor="let item of questionsFormGroup.get('questionSet')?.value"
            >
              <mat-accordion class="accordion">
                <mat-expansion-panel class="accordion-panel" [expanded]="true">
                  <mat-expansion-panel-header>
                    <mat-panel-title>
                      {{ item.sectionName }} ({{ item.questionsArray.length }})
                    </mat-panel-title>
                  </mat-expansion-panel-header>
                  <mat-list
                    *ngFor="let question of item.questionsArray; let i = index"
                  >
                    <div
                      [ngClass]="i % 2 === 0 ? 'even' : 'even'"
                      class="flex-container highlight-on-hover center-content"
                    >
                      <div class="left-content">
                        {{ i + 1 }}. {{ question.name }}
                      </div>
                    </div>
                  </mat-list>
                </mat-expansion-panel>
              </mat-accordion>
            </div>
          </div>
          <div class="align-end example-button-row">
            <button mat-button color="accent" (click)="stepper.reset()">
              Reset
            </button>
            <button mat-stroked-button matStepperPrevious color="accent">
              Back
            </button>
            <button mat-raised-button color="primary" (click)="submit()">
              Submit
            </button>
          </div>
        </mat-step>
      </mat-stepper>
    </mat-tab>
  </mat-tab-group>
  <mat-tab-group *ngIf="viewTab" style="background: #d5e2f2">
    <mat-tab label="View Template Creation">
      <div class="table-container">
        <div class="template-info">
          <p>Template Name : {{ selectedTemplate.templateName }}</p>
          <p>Domain : {{ selectedTemplate.domainId.name }}</p>
          <p>Assessment Type:{{ selectedTemplate.assessmentId.name }}</p>
        </div>
        <div *ngIf="selectedTemplate.questionsPerSection.length">
          <div
            class="accordion-container"
            *ngFor="let item of selectedTemplate.questionsPerSection"
          >
            <mat-accordion class="accordion">
              <mat-expansion-panel class="accordion-panel" [expanded]="true">
                <mat-expansion-panel-header>
                  <mat-panel-title>
                    {{ item.sectionId.name }} ({{ item.questionId.length }})
                  </mat-panel-title>
                </mat-expansion-panel-header>
                <mat-list
                  *ngFor="let question of item.questionId; let i = index"
                >
                  <div
                    [ngClass]="i % 2 === 0 ? 'even' : 'even'"
                    class="flex-container highlight-on-hover center-content"
                  >
                    <div class="left-content">
                      {{ i + 1 }}. {{ question.name }}
                    </div>
                  </div>
                </mat-list>
              </mat-expansion-panel>
            </mat-accordion>
          </div>
        </div>
      </div>
    </mat-tab>
  </mat-tab-group>
</main>
